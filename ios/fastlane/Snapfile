# Snapfile for Footprint Travel Tracker
# Configuration for automated screenshot generation

# A list of devices you want to take the screenshots from
# Available: iPhone 17 Pro, iPhone 17 Pro Max, iPhone Air, iPhone 17, iPhone 16e,
#            iPad Pro 13-inch (M5), iPad Pro 11-inch (M5), iPad mini (A17 Pro),
#            iPad (A16), iPad Air 13-inch (M3), iPad Air 11-inch (M3)
devices([
  "iPhone 17 Pro Max",                     # 6.9" - Required for App Store
  "iPhone 17 Pro",                         # 6.3" - Required for App Store
  "iPhone 17",                             # 6.1" - Required for App Store
  "iPhone 16e",                            # Smaller iPhone
  "iPad Pro 13-inch (M5)",                 # 13" iPad - Required for iPad App Store
  "iPad Pro 11-inch (M5)"                  # 11" iPad - Additional iPad size
])

# Languages to generate the screenshots for
languages([
  "en-US"
])

# The name of the scheme which contains the UI Tests
scheme("FootprintUITests")

# Where should the resulting screenshots be stored?
output_directory("./fastlane/screenshots")

# Clear all previously generated screenshots before creating new ones
clear_previous_screenshots(true)

# Remove the '#' to clear all previously generated screenshots before creating new ones
override_status_bar(true)

# Arguments to pass to the app on launch. See https://docs.fastlane.tools/actions/snapshot/#launch-arguments
launch_arguments([
  "-ApplePersistenceIgnoreState YES",
  "-UITestingMode YES",
  "-DisableAnimations YES",
  "-SampleDataMode YES"
])

# STABILITY OPTIONS - Critical for avoiding "signal kill" crashes
concurrent_simulators(false)       # Run one simulator at a time to avoid resource exhaustion
erase_simulator(true)              # Clean slate for each run
reinstall_app(true)                # Force reinstall before testing

# Disable headless mode - can help with simulator stability issues
headless(false)

# Remove the '#' to disable slide to type on the iOS simulator
disable_slide_to_type(true)

# Stop immediately after the first test failure
# If you want to test all devices even if one fails, set this to false
stop_after_first_error(false)

# Disable localization when using reinstall_app to avoid conflicts
localize_simulator(false)

# Configure build configuration
configuration("Debug")

# Skip xcpretty to avoid Ruby version conflicts
# (xcpretty subprocess tries to use system Ruby 2.6 which conflicts with Homebrew Ruby 4.0)
xcodebuild_formatter("")

# Use a consistent derived data path to avoid rebuild issues
derived_data_path("./fastlane/DerivedData")
